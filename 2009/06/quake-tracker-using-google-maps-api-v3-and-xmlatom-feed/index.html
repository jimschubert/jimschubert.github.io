<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.72.0" />

    
    
    

<title>Quake Tracker using Google Maps API v3 and XML/Atom feed • I Prefer Jim</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Quake Tracker using Google Maps API v3 and XML/Atom feed"/>
<meta name="twitter:description" content="http://www.ipreferjim.com/maps/quakes.html
For this, I used the following:
 Google Maps API v3 (http://code.google.com/apis/maps/documentation/v3/) jQuery v1.3.2 (http://jquery.com/)  First, you will need to include the google maps api in your header:"/>

<meta property="og:title" content="Quake Tracker using Google Maps API v3 and XML/Atom feed" />
<meta property="og:description" content="http://www.ipreferjim.com/maps/quakes.html
For this, I used the following:
 Google Maps API v3 (http://code.google.com/apis/maps/documentation/v3/) jQuery v1.3.2 (http://jquery.com/)  First, you will need to include the google maps api in your header:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ipreferjim.com/2009/06/quake-tracker-using-google-maps-api-v3-and-xmlatom-feed/" />
<meta property="article:published_time" content="2009-06-17T22:38:00+00:00" />
<meta property="article:modified_time" content="2009-06-17T22:38:00+00:00" /><meta property="og:site_name" content="I Prefer Jim" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.1d734ca591261200417c9d5de423a667cc5271b6576cc2ea477fce0dd8c628d0.css">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" media="print">




<link rel="stylesheet" href="/scss/hugo-toc.11a9185f83b7761946f8d16ae214f4d959edaf003337338e55935920cc7852d7.css">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.ipreferjim.com/">I Prefer Jim</a>
      </span>
      
      
        <div class="author-image">
          <img src="https://www.gravatar.com/avatar/466dc28e15028c7353552022d2de1f9e?s=240&d=mp" class="img--circle img--headshot element--center" alt="gravatar">
        </div>
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">I Prefer Jim</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/tags/">
						<span>Tags</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/categories/">
						<span>Categories</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/books/">
						<span>Books</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/jimschubert" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/jimschubert" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/jamesschubert" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://stackoverflow.com/users/151445" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2020 Jim Schubert
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Quake Tracker using Google Maps API v3 and XML/Atom feed</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jun 17, 2009
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/blog">BLOG</a>
              •
          
              <a class="badge badge-category" href="/categories/code">CODE</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/google-apis">google apis</a>
           
      
          <a class="badge badge-tag" href="/tags/google-maps">google maps</a>
           
      
          <a class="badge badge-tag" href="/tags/javascript">javascript</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 3 min read
</div>


  </header>
  
  
  
  
  <div class="post">
    <p><a href="http://www.ipreferjim.com/maps/quakes.html">http://www.ipreferjim.com/maps/quakes.html</a></p>
<p>For this, I used the following:</p>
<ul>
<li>Google Maps API v3 (<a href="http://code.google.com/apis/maps/documentation/v3/">http://code.google.com/apis/maps/documentation/v3/</a>)</li>
<li>jQuery v1.3.2 (<a href="http://jquery.com/">http://jquery.com/</a>)</li>
</ul>
<p>First, you will need to include the google maps api in your header:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;http://maps.google.com/maps/api/js?sensor=true&#34;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span><span class="o">&amp;</span><span class="nx">gt</span>
</code></pre></div><p>This line of code is slightly different from the v2 API because an API key isn’t needed. This will probably change in the near future. It is also necessary to load jQuery, which can be done by downloading it from the above link, or loading it via Google’s AJAX API.</p>
<p>When the document is ready:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// init map
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">map</span><span class="p">;</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">latlng</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="mf">35.6802</span><span class="p">,</span> <span class="o">-</span><span class="mf">121.1165</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">myOptions</span> <span class="o">=</span> <span class="p">{</span>
<span class="hl">     <span class="nx">zoom</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span class="hl">    <span class="nx">center</span><span class="o">:</span> <span class="nx">latlng</span><span class="p">,</span>
</span><span class="hl">    <span class="nx">mapTypeControl</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class="hl">    <span class="nx">mapTypeControlOptions</span><span class="o">:</span> <span class="p">{</span><span class="nx">style</span><span class="o">:</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">MapTypeControlStyle</span><span class="p">.</span><span class="nx">DROPDOWN_MENU</span><span class="p">},</span>
</span><span class="hl">     <span class="nx">navigationControl</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class="hl">     <span class="nx">navigationControlOptions</span><span class="o">:</span> <span class="p">{</span><span class="nx">style</span><span class="o">:</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">NavigationControlStyle</span><span class="p">.</span><span class="nx">SMALL</span><span class="p">},</span>
</span><span class="hl">     <span class="nx">mapTypeId</span><span class="o">:</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">MapTypeId</span><span class="p">.</span><span class="nx">SATELLITE</span>
</span>     <span class="p">};</span>
  
<span class="hl">   <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;map&#34;</span><span class="p">),</span> <span class="nx">myOptions</span><span class="p">);</span>  
</span> <span class="p">});</span>
</code></pre></div><p>First of all, I create a global variable called map, so I can use it in each function.</p>
<p>Then, when the document is ready, I get a geographic coordinate which Google Maps builds from maps.LatLng. This coordinate is in California, because I know there are quakes there.</p>
<p>Next, I’ve set a number of options (lines 6-12) for the map including:</p>
<ul>
<li>zoom level</li>
<li>map center</li>
<li>a control to allow user to change the look of the map</li>
<li>a control to allow user to change zoom</li>
<li>default map type of “SATELLITE”, which shows tectonic regions</li>
</ul>
<p>The Google Maps API v3 makes it very easy to supply these options to the Map constuctor, as you can see on line 15 of the first code snippet. The map is loaded into the DOM object supplied as the first parameter in the constructor.</p>
<p>When the map is ready:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// SEE : http://www.xml.com/pub/a/2007/10/10/jquery-and-xml.html
</span><span class="c1"></span>  
 <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#map&#39;</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
   <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
     <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;GET&#34;</span><span class="p">,</span>
     <span class="nx">url</span><span class="o">:</span> <span class="s2">&#34;getxml.php?q=http://www.earthquake.usgs.gov/eqcenter/catalogs/7day-M2.5.xml&#34;</span><span class="p">,</span>
     <span class="nx">dataType</span><span class="o">:</span> <span class="s2">&#34;xml&#34;</span><span class="p">,</span>
     <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xml</span><span class="p">){</span>
             <span class="nx">$</span><span class="p">(</span><span class="nx">xml</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;entry&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                  <span class="c1">// Retrieve all needed values from XML
</span><span class="c1"></span>                  <span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
                  <span class="kd">var</span> <span class="nx">updated</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;updated&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
                  <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
                  <span class="kd">var</span> <span class="nx">summary</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;summary&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
<span class="hl">                  <span class="kd">var</span> <span class="nx">coord</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;georss\\:point&#39;</span><span class="p">).</span><span class="nx">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
</span><span class="hl">                  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">coord</span><span class="p">){</span><span class="kd">var</span> <span class="nx">coord</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;point&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">();};</span>
</span>                  <span class="kd">var</span> <span class="nx">points</span> <span class="o">=</span> <span class="nx">coord</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
                  <span class="kd">var</span> <span class="nx">latitude</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                  <span class="kd">var</span> <span class="nx">longitude</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">points</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>    
<span class="hl">                  <span class="kd">var</span> <span class="nx">elev</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;georss\\:elev&#39;</span><span class="p">).</span><span class="nx">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
</span><span class="hl">                  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">elev</span><span class="p">){</span><span class="kd">var</span> <span class="nx">elev</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;elev&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">();};</span>
</span>                  <span class="kd">var</span> <span class="nx">htmlString</span> <span class="o">=</span> <span class="s2">&#34;&lt;b&gt;&#34;</span> <span class="o">+</span> <span class="nx">title</span> <span class="o">+</span> <span class="s2">&#34;&lt;/b&gt;&#34;</span> <span class="o">+</span> <span class="s2">&#34;&lt;p&gt;&#34;</span> <span class="o">+</span> <span class="nx">summary</span> <span class="o">+</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
                  <span class="c1">// create a marker
</span><span class="c1"></span>                  <span class="kd">var</span> <span class="nx">myLatlng</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="nx">latitude</span><span class="p">,</span><span class="nx">longitude</span><span class="p">);</span>
                      <span class="kd">var</span> <span class="nx">marker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">Marker</span><span class="p">(</span>
                      <span class="p">{</span>
                          <span class="nx">position</span><span class="o">:</span> <span class="nx">myLatlng</span><span class="p">,</span>
                          <span class="nx">map</span><span class="o">:</span> <span class="nx">map</span><span class="p">,</span>
                          <span class="nx">title</span><span class="o">:</span> <span class="nx">title</span>
                      <span class="p">});</span>
                  
<span class="hl">                      <span class="nx">addMarkerBubble</span><span class="p">(</span><span class="nx">marker</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">htmlString</span><span class="p">);</span>
</span>                      <span class="c1">// Show output below map
</span><span class="c1"></span>                      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;&lt;/li&gt;&#39;</span><span class="p">)</span>
                          <span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">title</span> <span class="o">+</span> <span class="s1">&#39; (updated: &#39;</span> <span class="o">+</span> <span class="nx">updated</span> <span class="o">+</span> <span class="s1">&#39;) at &#39;</span> <span class="o">+</span> <span class="nx">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nx">points</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                          <span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="s1">&#39;#output&#39;</span><span class="p">);</span>
              <span class="p">});</span><span class="c1">// end each
</span><span class="c1"></span>          <span class="p">}</span>
      <span class="p">});</span> <span class="c1">// end $.ajax
</span><span class="c1"></span>  <span class="p">});</span><span class="c1">// end function
</span><span class="c1"></span>   
  <span class="kd">function</span> <span class="nx">addMarkerBubble</span><span class="p">(</span><span class="nx">marker</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">message</span><span class="p">){</span>    
      <span class="c1">// set balloon
</span><span class="c1"></span>      <span class="kd">var</span> <span class="nx">infowindow</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">InfoWindow</span><span class="p">(</span>
      <span class="p">{</span>
            <span class="nx">content</span><span class="o">:</span> <span class="nx">message</span><span class="p">,</span>
        <span class="nx">size</span><span class="o">:</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
      <span class="p">});</span>        
      
      <span class="c1">// add listener to marker
</span><span class="c1"></span>      <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">marker</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span> <span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
          <span class="nx">infowindow</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span><span class="nx">marker</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">};</span>
</code></pre></div><p>The second snippet is the AJAX call to retrieve the feed and build the markers and info windows when the GET succeeds.</p>
<p>Inside the function call, I’ve used jQuery’s simplified DOM access for the returned XML. On line 9 of this snippet, I find each ‘entry’ node and then iterate over each of these nodes to find the text of each node value.</p>
<p>On lines 15-16 and 20-21, I check the variables because some browsers properly process namespaced nodes and some don’t. This simple check allows the application to display properly in Chrome, Safari, Firefox, and Internet Explorer.</p>
<p>Next, I create a marker on the map at the given coordinate and give it a title (tooltip).</p>
<p>On line 32, I call the function ‘addMarkerBubble’ to create an info window and add the event to the map. After this, I add the title and updated date to a div element below the map.</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/2009/06/javascript-css-modal-loading-div/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">JavaScript &amp; CSS Modal Loading DIV</span>
    </a>
    
    
    <a href="/2009/07/job-hunting/" class="navigation-next">
      <span class="navigation-tittle">Job Hunting</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  


<div class="post__related">
    
    <h2>Related Articles</h2>
    <ul class="related-posts">
        
<li>
  <span class="list__title--small">
    <a href="/2009/06/javascript-css-modal-loading-div/" >JavaScript &amp; CSS Modal Loading DIV</a>
      
      <time class="pull-right hidden-tablet">Jun 17, 2009</time>
      
  </span>
</li>


    </ul>
</div>



  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.11.2/js/all.js" integrity="sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1" crossorigin="anonymous"></script>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    





    



    </body>
</html>
