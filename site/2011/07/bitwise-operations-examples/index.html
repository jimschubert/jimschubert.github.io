<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.72.0" />

    
    
    

<title>Bitwise Operations: Examples • I Prefer Jim</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Bitwise Operations: Examples"/>
<meta name="twitter:description" content="One post that I’ve always loved on stackoverflow is this post by Hugoware which contains some useful extension methods for bitwise operations."/>

<meta property="og:title" content="Bitwise Operations: Examples" />
<meta property="og:description" content="One post that I’ve always loved on stackoverflow is this post by Hugoware which contains some useful extension methods for bitwise operations." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.ipreferjim.com/site/2011/07/bitwise-operations-examples/" />
<meta property="article:published_time" content="2011-07-19T22:57:08+00:00" />
<meta property="article:modified_time" content="2011-07-19T22:57:08+00:00" /><meta property="og:site_name" content="I Prefer Jim" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/site/scss/hyde-hyde.1d734ca591261200417c9d5de423a667cc5271b6576cc2ea477fce0dd8c628d0.css" integrity="sha256-HXNMpZEmEgBBfJ1d5COmZ8xScbZXbMLqR3/ODdjGKNA=">


<link rel="stylesheet" href="/site/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">




<link rel="stylesheet" href="/site/scss/hugo-toc.11a9185f83b7761946f8d16ae214f4d959edaf003337338e55935920cc7852d7.css" integrity="sha256-EakYX4O3dhlG&#43;NFq4hT02VntrwAzNzOOVZNZIMx4Utc=">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="http://www.ipreferjim.com/site/">I Prefer Jim</a>
      </span>
      
      
        <div class="author-image">
          <img src="https://www.gravatar.com/avatar/466dc28e15028c7353552022d2de1f9e?s=240&d=mp" class="img--circle img--headshot element--center" alt="gravatar">
        </div>
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">I Prefer Jim</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/site/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/site/tags/">
						<span>Tags</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/site/categories/">
						<span>Categories</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/site/books/">
						<span>Books</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/jimschubert" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/jimschubert" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/jamesschubert" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://stackoverflow.com/users/151445" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2020 Jim Schubert
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Bitwise Operations: Examples</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jul 19, 2011
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/site/categories/blog">BLOG</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/site/tags/.net">.net</a>
           
      
          <a class="badge badge-tag" href="/site/tags/advanced">advanced</a>
           
      
          <a class="badge badge-tag" href="/site/tags/c">c#</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 6 min read
</div>


  </header>
  
  
  
  
  <div class="post">
    <p>One post that I’ve always loved on stackoverflow is <a title="Stackoverflow.com post: Most common C# bitwise operations" href="http://stackoverflow.com/questions/93744/most-common-c-bitwise-operations/417217#417217" target="_blank">this post by Hugoware</a> which contains some useful extension methods for bitwise operations.</p>
<p>Bitwise operations can be used to perform all kinds of useful calculations. Below are some examples to whet your appetite for knowledge.</p>
<h2 id="1-list-of-integers-trickery">1) List of Integers trickery</h2>
<p>You may have seen this question somewhere in some form or another: “Given a list of integers of unknown size where all but one integer occurs an even number of times, find the odd integer.”  This is usually a part of some algorithm coding-for-fun puzzle.  When I first came across this question, I tried a number of different ways to loop through a list, none of which were optimal.  In the end, I realized you can use <strong>XOR</strong> bitwise operations to do this.</p>
<p>First, create a list of integers and set your control integer to <strong>23</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">items</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">100</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> <span class="p">{</span>
  <span class="n">items</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="p">==</span> <span class="m">23</span><span class="p">)</span> <span class="p">{</span> <span class="n">items</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Then, create a value to keep watch, and perform an <strong>XOR</strong> on every value:</p>
<div class="highlight"><pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="kt">int</span> <span class="n">found</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">int</span> <span class="n">item</span> <span class="k">in</span> <span class="n">items</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">found</span> <span class="p">^=</span> <span class="n">item</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Finally, output to console or inspect the <strong>found</strong> variable to be sure it contains the number 23.</p>
<h3 id="why-this-works">Why this works</h3>
<p>The complexity of this algorithm is O(n)–one operation per <em>n</em> items. It doesn’t get any easier than that. If you were to add more loops or extra data structures to maintain values, you degrade performance.</p>
<p>If you’ve read my <a href="http://www.ipreferjim.com/2010/07/bitwise-operations-and-flags/" title="Bitwise operations and flags" target="_blank">previous post</a> about bitwise operations, you may remember that an <strong>XOR</strong> toggles the bits. When you start at zero, all even occurrences will be zero when the loop is completed. The only bits left will be the bits from the odd occurrence of an integer (in other words, 0 ^ 23 = 23).</p>
<p>Cool, huh?</p>
<h2 id="2-division-by-2-or-3">2) Division by 2 or 3</h2>
<p>This is one of the few things I remember from my Information Systems class at VCU (sorry, Dr. Wynne). My professor work on a project many years ago, trying to debug a performance issue. When running through certain calculations, the application performance would reduce by orders of magnitude. The problem was with how the application was performing division. Sorry, I don’t remember the exact details because I think it was being done in Assembly (I guess I don’t even remember this story from VCU!). The solution was to perform bitwise division on the value. For example:</p>
<div class="highlight"><pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">items</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">1000</span><span class="p">;</span> <span class="n">i</span><span class="p">+=</span><span class="m">2</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">items</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">foreach</span> <span class="p">(</span><span class="kt">int</span> <span class="n">item</span> <span class="k">in</span> <span class="n">items</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;{0} / 2 = {1}&#34;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">item</span> <span class="p">&gt;&gt;</span> <span class="m">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><h3 id="why-this-works-1">Why this works</h3>
<p>Let’s look at a single number, 6. The bits for 6 look like:</p>
<pre><code>0 1 1 0
</code></pre><p>This means the 2 bit and the 4 bit are set. If you use the right-shift operator (‘&raquo;’), you’re moving all of the bits that many positions to the right. So, if you perform ‘6 &raquo; 1’, you get:</p>
<pre><code>0 0 1 1
</code></pre><p>Sure enough, that’s 3!</p>
<p>Now, you may be thinking “How often do I need to divide by 2?” Well, this doesn’t just work for the number 2. You can lop off any number of bits.</p>
<p>x &raquo; 2 is the same as x / 4 ( or x / (2^2) ).</p>
<p>x &raquo; 3 is the same as x / 8 ( or x / (2^3) ).</p>
<p>And so on…</p>
<h3 id="what-if-i-want-to-divide-by-an-odd-number">What if I want to divide by an odd number?!</h3>
<p>Then do something like: x / 3. <em>Seriously</em>. If you’re interested, you can take a look at <a href="http://stackoverflow.com/questions/171301/whats-the-fastest-way-to-divide-an-integer-by-3/171369#171369" title="Divide by 3 in binary!">this post on stackoverflow</a>.</p>
<p>What you do in this case is use a magic number which causes the left-most 32bits in a 64bit result to be equal to the result of dividing by 3. Then you shift those 32 insignificant bits off. Be careful, though, because you can easily overflow your value type. Here’s an example:</p>
<div class="highlight"><pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;300 / 3 = {0}&#34;</span><span class="p">,</span> <span class="p">(</span><span class="m">300L</span> <span class="p">*</span> <span class="m">1431655766</span><span class="p">)</span> <span class="p">&gt;&gt;</span> <span class="m">32</span> <span class="p">);</span>
</code></pre></div><p>If you look at the binary for that magic number (1431655766), you’ll see:</p>
<pre><code>0101 0101 0101 0101 0101 0101 0101 0110
</code></pre><p>You don’t need to memorize this magic number. You can easily build it:</p>
<div class="highlight"><pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="kt">int</span> <span class="n">result</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span><span class="p">&lt;=</span><span class="m">8</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> <span class="p">{</span>
   <span class="n">result</span> <span class="p">=</span> <span class="p">(</span><span class="n">result</span> <span class="p">&lt;&lt;</span> <span class="m">4</span><span class="p">)</span> <span class="p">^</span> <span class="m">5</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">result</span> <span class="p">+=</span> <span class="m">1</span><span class="p">;</span>
</code></pre></div><p>This takes the binary representation of 5 (0101) and buffers that <a href="http://en.wikipedia.org/wiki/Nibble" title="Nibble on Wikipedia" target="_blank">nibble</a> until it fills 32 bits, then adds 1 which basically moves the last bit. That’s the magic. We’ve created a magic number which is 6 (110) preceded by alternating 1’s and 0’s.</p>
<p>To see what this is doing in something a little simpler like 6/3=2, you can run this bit of code and inspect the binary displayed.</p>
<div class="highlight"><pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="kt">long</span> <span class="n">tester</span> <span class="p">=</span> <span class="m">6L</span> <span class="p">*</span> <span class="m">1431655766</span><span class="p">;</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">Convert</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="n">tester</span><span class="p">,</span> <span class="m">2</span><span class="p">).</span><span class="n">PadLeft</span><span class="p">(</span><span class="m">36</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="p">));</span>
</code></pre></div><p>Notice that I used 36 digits to pad because I know 6/3 is 2 and I only need 4 extra bits to show that. In the binary below, instead of separating each by by a space, I’ve separated the 32 bits we’ll lop off from the end result.</p>
<pre><code>0010 00000000000000000000000000000100
</code></pre><p>When you shift this result by 32 bits, you’re left with the answer: 2.</p>
<h3 id="why-does-this-work">Why does this work?</h3>
<p><a href="http://en.wikipedia.org/wiki/Binary_multiplier#Multiplication_basics" title="Binary Multiplication - Multiplication Basics" target="_blank">Binary Multiplication</a>.</p>
<p>Take, for example, the magic number multiplied by 243 = 347892351138.</p>
<p>Our answer should be: 243/3 = 81.</p>
<pre><code>01010101010101010101010101010110
            x                         11110011
______________________________________________
              01010101010101010101010101010110
            0 10101010101010101010101010101100
           00 00000000000000000000000000000000
          000 00000000000000000000000000000000
         0101 01010101010101010101010101100000
        01010 10101010101010101010101011000000
       010101 01010101010101010101010110000000
      0101010 10101010101010101010101100000000
______________________________________________
      1010001 00000000000000000000000010100010
</code></pre><p>As you can see, the end result (the last line) is the binary representation of 81!</p>
<h2 id="3-obfuscation">3) Obfuscation</h2>
<p>You can use <strong>XOR</strong> or any other bitwise operation to obfuscate a string. The idea is to take a single character, XOR all characters in a sentence with your secret to <em>obfuscate</em>. To <em>deobfuscate</em>, you XOR all characters in your obfuscated string and the result should be your original string!</p>
<p>Here’s a quick example:</p>
<div class="highlight"><pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="kt">char</span> <span class="n">key</span> <span class="p">=</span> <span class="sc">&#39;*&#39;</span><span class="p">;</span>
<span class="kt">string</span> <span class="n">sentence</span> <span class="p">=</span> <span class="s">&#34;Would you like to play a game?!&#34;</span><span class="p">;</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;Original string: &#39;{0}&#39;&#34;</span><span class="p">,</span> <span class="n">sentence</span><span class="p">);</span>

<span class="kt">string</span> <span class="n">obfuscated</span> <span class="p">=</span> <span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">sentence</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">obfuscated</span> <span class="p">+=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)(</span><span class="n">item</span> <span class="p">^</span> <span class="n">key</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;obfuscated string: {0}&#34;</span><span class="p">,</span> <span class="n">obfuscated</span><span class="p">);</span>
<span class="kt">string</span> <span class="n">deobfuscated</span> <span class="p">=</span> <span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">obfuscated</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">deobfuscated</span> <span class="p">+=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)(</span><span class="n">item</span> <span class="p">^</span> <span class="n">key</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&#34;deobfuscated string: {0}&#34;</span><span class="p">,</span> <span class="n">deobfuscated</span><span class="p">);</span>
</code></pre></div><p>The output should look something like (non-printing characters are not displayed, so you may see something slightly different):</p>
<pre><code>Original string: 'Would you like to play a game?!'
obfuscated string: }E_FN
SE_
FCAO
^E
ZFKS
K
MKGO
deobfuscated string: Would you like to play a game?!
</code></pre>
  </div>
  

<div class="navigation navigation-single">
    
    <a href="/site/2011/07/hostgator-ssh-warns-too-many-authentication-failures/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Hostgator: ssh warns ‘too many authentication failures’</span>
    </a>
    
    
    <a href="/site/2011/07/installing-parpacker-in-windows/" class="navigation-next">
      <span class="navigation-tittle">Installing PAR::Packer (in Windows or Linux)</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  


<div class="post__related">
    
    <h2>Related Articles</h2>
    <ul class="related-posts">
        
<li>
  <span class="list__title--small">
    <a href="/site/2010/07/bitwise-operations-and-flags/" >Bitwise operations and Flags (C#)</a>
      
      <time class="pull-right hidden-tablet">Jul 31, 2010</time>
      
  </span>
</li>

<li>
  <span class="list__title--small">
    <a href="/site/2010/06/using-dataannotation-attributes-to-validate-membership-password/" >Using DataAnnotation attributes to validate Membership password</a>
      
      <time class="pull-right hidden-tablet">Jun 11, 2010</time>
      
  </span>
</li>

<li>
  <span class="list__title--small">
    <a href="/site/2010/05/finding-a-users-local-time-from-utc-offset/" >Finding a user’s local time from UTC offset</a>
      
      <time class="pull-right hidden-tablet">May 4, 2010</time>
      
  </span>
</li>

<li>
  <span class="list__title--small">
    <a href="/site/2010/02/explaining-advanced-features-of-c-3-0/" >Explaining advanced features of C# 3.0</a>
      
      <time class="pull-right hidden-tablet">Feb 15, 2010</time>
      
  </span>
</li>

<li>
  <span class="list__title--small">
    <a href="/site/2011/07/what-happens-when-i-overwrite-a-dll-asp-net/" >What happens when I overwrite a DLL (asp.net)?</a>
      
      <time class="pull-right hidden-tablet">Jul 9, 2011</time>
      
  </span>
</li>


    </ul>
</div>



  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.11.2/js/all.js" integrity="sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1" crossorigin="anonymous"></script>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    





    



    </body>
</html>
