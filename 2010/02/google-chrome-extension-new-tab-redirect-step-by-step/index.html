<!DOCTYPE html>
<html lang="en">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.72.0" />

    
    
    

<title>Google Chrome Extension: New Tab Redirect! STEP BY STEP • I Prefer Jim</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Google Chrome Extension: New Tab Redirect! STEP BY STEP"/>
<meta name="twitter:description" content="If you’ve reached this this page in an attempt to find instructions for uninstalling the extension here they are:
 Navigate to chrome://extensions Click ‘Uninstall’ below ‘New Tab Redirect!"/>

<meta property="og:title" content="Google Chrome Extension: New Tab Redirect! STEP BY STEP" />
<meta property="og:description" content="If you’ve reached this this page in an attempt to find instructions for uninstalling the extension here they are:
 Navigate to chrome://extensions Click ‘Uninstall’ below ‘New Tab Redirect!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ipreferjim.com/2010/02/google-chrome-extension-new-tab-redirect-step-by-step/" />
<meta property="article:published_time" content="2010-02-13T22:45:00+00:00" />
<meta property="article:modified_time" content="2010-02-13T22:45:00+00:00" /><meta property="og:site_name" content="I Prefer Jim" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.1d734ca591261200417c9d5de423a667cc5271b6576cc2ea477fce0dd8c628d0.css">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" media="print">




<link rel="stylesheet" href="/scss/hugo-toc.11a9185f83b7761946f8d16ae214f4d959edaf003337338e55935920cc7852d7.css">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.ipreferjim.com/">I Prefer Jim</a>
      </span>
      
      
        <div class="author-image">
          <img src="https://www.gravatar.com/avatar/466dc28e15028c7353552022d2de1f9e?s=240&d=mp" class="img--circle img--headshot element--center" alt="gravatar">
        </div>
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">I Prefer Jim</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/tags/">
						<span>Tags</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/categories/">
						<span>Categories</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/books/">
						<span>Books</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/jimschubert" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/jimschubert" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/jamesschubert" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://stackoverflow.com/users/151445" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2020 Jim Schubert
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Google Chrome Extension: New Tab Redirect! STEP BY STEP</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Feb 13, 2010
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/blog">BLOG</a>
              •
          
              <a class="badge badge-category" href="/categories/code">CODE</a>
              •
          
              <a class="badge badge-category" href="/categories/examples">EXAMPLES</a>
              •
          
              <a class="badge badge-category" href="/categories/projects">PROJECTS</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/google-apis">google apis</a>
           
      
          <a class="badge badge-tag" href="/tags/javascript">javascript</a>
           
      
          <a class="badge badge-tag" href="/tags/projects">projects</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 9 min read
</div>


  </header>
  
  
  
  
  <div class="post">
    <p>If you’ve reached this this page in an attempt to find instructions for uninstalling the extension here they are:</p>
<ol>
<li>Navigate to chrome://extensions</li>
<li>Click ‘Uninstall’ below ‘New Tab Redirect!’</li>
</ol>
<p>Yes, it’s that easy.</p>
<p>If you’re doing this because you can no longer find your apps, add a bookmark called “Apps” that points to</p>
<pre><code>chrome-internal://newta
</code></pre><p>Finally, if you’re wondering what magic was used to create this extension, read on.</p>
<h1 id="background">Background</h1>
<p>(see <a href="http://code.google.com/chrome/extensions/overview.html">http://code.google.com/chrome/extensions/overview.html</a> for a thorough background of Chrome Extension development)</p>
<p>A Google Chrome Extension is a mini web application which runs in its own process and can perform actions at a browser-level or page-level.</p>
<p>An extension consists (or may consist) of a number of parts:</p>
<ul>
<li>manifest.json</li>
<li>Web files (html, js, css, images)</li>
<li>NPAPI Plugins</li>
<li>background.html (the long-running process)</li>
</ul>
<p>All of these files are bundled into a package with a .crx file extension. When uploading your extension to the Google Chrome Extensions Gallery, you only zip up the files your extension needs and Google will package it properly for you.</p>
<p>The manifest.json file is a file which specifies properties of your extension in JavaScript Object Notation (aka JSON). For a quick intro to JSON, check out <a href="http://www.learn-ajax-tutorial.com/Json.cfm">http://www.learn-ajax-tutorial.com/Json.cfm</a></p>
<h2 id="the-manifest-file">The Manifest File</h2>
<p>manifest.json:</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">{
   &#34;name&#34;: &#34;New Tab Redirect!&#34;,
   &#34;description&#34;: &#34;Sets a user-specified URL to load in new tabs.&#34;,
   &#34;version&#34;: &#34;0.0.1.109&#34;,
   &#34;background_page&#34;: &#34;background.html&#34;,
   &#34;options_page&#34;:&#34;options.html&#34;,
   &#34;chrome_url_overrides&#34;: {
     &#34;newtab&#34;: &#34;redirect.html&#34;
   },
      &#34;permissions&#34;: [&#34;tabs&#34;],
      &#34;icons&#34;: {
      &#34;128&#34;: &#34;icon128.png&#34;,
      &#34;19&#34;:&#34;icon19.png&#34;
    }
  }
</code></pre></div><p>(end manifest.json)</p>
<p>The name, description, version, background_page, and options_page key/value pairs are pretty self-explanatory.</p>
<p>The <em>“chrome_url_overrides”</em> section is interesting. As you can see, the value for this entry is itself an object. This object allows me to override <em>“newtab”</em> with my own page, <em>“redirect.html”</em>. Currently, the chromium team will only allow you to override newtab, however, I anticipate they’ll allow you to override other pages in the future. For a list of url constants used within Chrome, check out the <a href="http://src.chromium.org/svn/trunk/src/chrome/common/url_constants.cc">url_constants.cc</a> file in the source code repository. Possible future overrides would be anything that is listed near the end of that file as ‘const char kChromeUI*Host[]’</p>
<p>Back to the file. <em>“permissions”</em> takes an array of requested permissions. New Tab Redirect! requires permissions to update tabs. This is because we’re not only redirecting to html web-hosted sites; New Tab Redirect allows you to set web pages, local files, or inherent Chrome pages.</p>
<p><em>“icons”</em> specifies the location of the icons your extension will use. These icons will be displayed in the Gallery and in the Extensions page within Google Chrome.</p>
<p><strong>Remember:</strong> You must change your version number when updating your publicly hosted extension, or else Chrome won’t find a new version and your users will not be updated.</p>
<h1 id="the-background-page">The Background Page</h1>
<p>background.html</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;html&gt;</span>
 <span class="nt">&lt;head&gt;</span>
 <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&#34;text/javascript&#34;</span><span class="nt">&gt;</span>
 String.prototype.startsWith = function(str){
     return (this.indexOf(str) === 0);
 }
  
 var url = null;
 var newTabId = undefined;
  var protocol =  undefined;
  var allowedProtocols = [&#34;http://&#34;,&#34;https://&#34;,&#34;about:&#34;,&#34;file://&#34;, 
    &#34;file:\\&#34;, &#34;file:///&#34;, &#34;chrome://&#34;,&#34;chrome-internal://&#34;];
   
  function setUrl(url) {
          if(protocolPasses(url) 
            <span class="err">&amp;&amp;</span> url.length &gt;  { /* 8 is arbitrary */
              this.url = url;     
          } else {
              protocol = &#39;http://&#39;; /* force http */
              var right = url.split(&#39;://&#39;)
              if(right != undefined <span class="err">&amp;&amp;</span> right != null <span class="err">&amp;&amp;</span> right.length &gt; 1) {
                  this.url = protocol + right[1];
              } else { 
                  /* this will redirect to http:// if url is empty */
                  this.url = protocol + url; }    
          }
          localStorage[&#34;url&#34;]  = this.url;
          
      function protocolPasses(url) {
          if(typeof(url) == &#39;undefined&#39; || url == null) { return false; }
          if (url.startsWith(allowedProtocols[3]) 
              <span class="err">&amp;&amp;</span> !url.startsWith(allowedProtocols[5])) {
              url.replace(allowedProtocols[3], allowedProtocols[5]);
          } else if (url.startsWith(allowedProtocols[4])) {
              url.replace(allowedProtocols[4], allowedProtocols[5]);
          }
          
          for(var p in allowedProtocols) {
              if(url.startsWith(allowedProtocols[p])) { return true;}
          }
          return false;
      }
  }
   
  function init() {
     url = localStorage[&#34;url&#34;] || &#34;http://www.facebook.com&#34;;
  }
   
  function r(tabId) {
      chrome.tabs.update(tabId, {&#34;url&#34;:this.url});
  }
   
  chrome.tabs.onUpdated.addListener(function(tabId,info,tab) {
      if (info.status === &#39;loading&#39;)
          console.log(&#39;Loading url ... &#39; + tab.url)
      if(info.status === &#39;complete&#39;)
          console.log(&#39;Finished loading url ... &#39; + tab.url)
  });
   
  chrome.tabs.onCreated.addListener(function(tab) {
      newTabId = tab.id
  });
  <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">&#34;init()&#34;</span><span class="nt">&gt;&lt;/body&gt;</span>
  <span class="nt">&lt;/html&gt;</span>

</code></pre></div><p>(end background.html)</p>
<p>This page is pretty self-explanatory for the most part. The background page is your long-running process, and is usually used to house any variables that are shared between pages. However, this isn’t a necessity of Chrome Extension architecture. Every page in an extension can interact with any other page through <strong>chrome.extension.getViews()</strong> or <strong>chrome.extension.getBackgroundPage()</strong> . Because of the nature of New Tab Redirect, I’ve used a background page.</p>
<p>One thing of note is the initialization of the extension. Since the operation is fairly simple, allowing a user to specify a url and then redirecting to that url, the only thing I need to worry about immediately is the url. This is stored using HTML 5’s local storage. If the url doesn’t exit, I set it to facebook.</p>
<p>The setUrl function is located in the Background page and is called from <em>options.html.</em> It is located here so the options page isn’t trying to set the url variable that is maintained by the background page. This function checks my array of allowed protocols and validates the url with some simple rules.</p>
<p><strong>r(tabId)</strong> is the function which actually updates the tab when the protocol isn’t an http or https protocol. The function name is short because the the code in redirect.html should be as concise as possible. This function calls the chrome.tabs.update method (one culprit behind the tabs permission requirement)</p>
<p>That <em>tabId</em> is provided via the redirect.html, which gets the currently created tab’s id. However, again note that this processing only occurs when the url is local.</p>
<h1 id="options">Options</h1>
<p>Because the options page is simple html and styles, I’ll only include the JavaScript which sets the url.</p>
<p>options.js</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">startsWith</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span><span class="o">===</span><span class="mi">0</span><span class="p">);</span>
 <span class="p">}</span>
 <span class="kd">var</span> <span class="nx">chromePages</span> <span class="o">=</span> <span class="p">{</span>
     <span class="nx">Extensions</span> <span class="o">:</span> <span class="s2">&#34;chrome://extensions/&#34;</span><span class="p">,</span>
     <span class="nx">History</span> <span class="o">:</span> <span class="s2">&#34;chrome://history/&#34;</span><span class="p">,</span>
     <span class="nx">Downloads</span> <span class="o">:</span> <span class="s2">&#34;chrome://downloads/&#34;</span><span class="p">,</span>
     <span class="nx">NewTab</span> <span class="o">:</span> <span class="s2">&#34;chrome-internal://newtab/&#34;</span>
 <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">aboutPages</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;about:blank&#34;</span><span class="p">,</span><span class="s2">&#34;about:version&#34;</span><span class="p">,</span> <span class="s2">&#34;about:plugins&#34;</span><span class="p">,</span><span class="s2">&#34;about:cache&#34;</span><span class="p">,</span> 
      <span class="s2">&#34;about:memory&#34;</span><span class="p">,</span><span class="s2">&#34;about:histograms&#34;</span><span class="p">,</span><span class="s2">&#34;about:dns&#34;</span><span class="p">,</span>
      <span class="s2">&#34;chrome://extensions/&#34;</span><span class="p">,</span><span class="s2">&#34;chrome://history/&#34;</span><span class="p">,</span>
      <span class="s2">&#34;chrome://downloads/&#34;</span><span class="p">,</span><span class="s2">&#34;chrome-internal://newtab/&#34;</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">popularPages</span> <span class="o">=</span> <span class="p">{</span> 
      <span class="s2">&#34;Facebook&#34;</span><span class="o">:</span><span class="s2">&#34;www.facebook.com&#34;</span><span class="p">,</span>
      <span class="s2">&#34;MySpace&#34;</span><span class="o">:</span><span class="s2">&#34;www.myspace.com&#34;</span><span class="p">,</span>
      <span class="s2">&#34;Twitter&#34;</span><span class="o">:</span><span class="s2">&#34;www.twitter.com&#34;</span><span class="p">,</span>
      <span class="s2">&#34;Digg&#34;</span><span class="o">:</span><span class="s2">&#34;www.digg.com&#34;</span><span class="p">,</span>
      <span class="s2">&#34;Delicious&#34;</span><span class="o">:</span><span class="s2">&#34;www.delicious.com&#34;</span><span class="p">,</span>
      <span class="s2">&#34;Slashdot&#34;</span><span class="o">:</span><span class="s2">&#34;www.slashdot.org&#34;</span>
  <span class="p">};</span>
   
      
  <span class="c1">// save options to localStorage.
</span><span class="c1"></span>  <span class="kd">function</span> <span class="nx">save_options</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#custom-url&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">url</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">){</span>
          <span class="nx">url</span> <span class="o">=</span> <span class="nx">aboutPages</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="p">}</span>
      
      <span class="k">if</span><span class="p">(</span> <span class="nx">$</span><span class="p">.</span><span class="nx">inArray</span><span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="nx">url</span><span class="p">),</span> <span class="nx">aboutPages</span><span class="p">)</span> <span class="o">||</span> <span class="nx">isValidURL</span><span class="p">(</span><span class="nx">url</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">save</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="nx">url</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">save</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="nx">url</span><span class="p">);</span>
      <span class="p">}</span>        
  <span class="p">}</span>
   
  <span class="kd">function</span> <span class="nx">save</span><span class="p">(</span><span class="nx">good</span><span class="p">,</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">good</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">chrome</span><span class="p">.</span><span class="nx">extension</span><span class="p">.</span><span class="nx">getBackgroundPage</span><span class="p">().</span><span class="nx">setUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#status&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&#34;Options Saved.&#34;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#status&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span> <span class="nx">url</span> <span class="o">+</span> <span class="s2">&#34; is invalid. Try again (http:// is required)&#34;</span><span class="p">);</span>    
      <span class="p">}</span>
      
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#status&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;display&#34;</span><span class="p">,</span> <span class="s2">&#34;block&#34;</span><span class="p">);</span>
      <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#status&#39;</span><span class="p">).</span><span class="nx">slideUp</span><span class="p">(</span><span class="s2">&#34;fast&#34;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&#34;display&#34;</span><span class="p">,</span> <span class="s2">&#34;none&#34;</span><span class="p">);</span>
      <span class="p">},</span> <span class="mi">1050</span><span class="p">);</span>
  <span class="p">}</span>
   
  <span class="c1">// Restores select box state to saved value from localStorage.
</span><span class="c1"></span>  <span class="kd">function</span> <span class="nx">restore_options</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">chrome</span><span class="p">.</span><span class="nx">extension</span><span class="p">.</span><span class="nx">getBackgroundPage</span><span class="p">().</span><span class="nx">url</span> <span class="o">||</span> <span class="s2">&#34;http://www.facebook.com/&#34;</span><span class="p">;</span>    
       <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#custom-url&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
  <span class="p">}</span>
   
  <span class="kd">function</span> <span class="nx">isValidURL</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">urlRegxp</span> <span class="o">=</span> <span class="sr">/^(http:\/\/www.|https:\/\/www.|ftp:\/\/www.|www.){1}([\w]+)(.[\w]+){1,2}$/</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">urlRegxp</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
  <span class="p">}</span>
   
  <span class="kd">function</span> <span class="nx">saveQuickLink</span><span class="p">(</span><span class="nx">url</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">uurl</span> <span class="o">=</span> <span class="nx">unescape</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
       <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#custom-url&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">uurl</span><span class="p">);</span>
       <span class="nx">save</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="nx">uurl</span><span class="p">);</span>
       <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
   
  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
      <span class="nx">restore_options</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">chromePages</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">anchor</span> <span class="o">=</span> <span class="s2">&#34;&lt;a href=\&#34;javascript:saveQuickLink(&#39;&#34;</span><span class="o">+</span><span class="nx">v</span><span class="o">+</span><span class="s2">&#34;&#39;);\&#34;&gt;&#34;</span><span class="o">+</span><span class="nx">k</span><span class="o">+</span><span class="s2">&#34;&lt;/a&gt;&#34;</span><span class="p">;</span>
          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#chromes&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;&lt;li&gt;&#34;</span> <span class="o">+</span> <span class="nx">anchor</span> <span class="o">+</span> <span class="s2">&#34;&lt;/li&gt;&#34;</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">aboutPages</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">&#34;about:&#34;</span><span class="p">))</span> <span class="p">{</span> <span class="cm">/* quick fix to handle chrome pages elsewhere */</span>
              <span class="kd">var</span> <span class="nx">anchor</span> <span class="o">=</span> <span class="s2">&#34;&lt;a href=\&#34;javascript:saveQuickLink(&#39;&#34;</span><span class="o">+</span><span class="k">this</span><span class="o">+</span><span class="s2">&#34;&#39;);\&#34;&gt;&#34;</span><span class="o">+</span><span class="k">this</span><span class="o">+</span><span class="s2">&#34;&lt;/a&gt;&#34;</span><span class="p">;</span>
              <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#abouts&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;&lt;li&gt;&#34;</span> <span class="o">+</span> <span class="nx">anchor</span> <span class="o">+</span> <span class="s2">&#34;&lt;/li&gt;&#34;</span><span class="p">);</span>
          <span class="p">}</span>
      <span class="p">});</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">popularPages</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">anchor</span> <span class="o">=</span> <span class="s2">&#34;&lt;a href=\&#34;javascript:saveQuickLink(&#39;&#34;</span><span class="o">+</span><span class="nx">v</span><span class="o">+</span><span class="s2">&#34;&#39;);\&#34;&gt;&#34;</span><span class="o">+</span><span class="nx">k</span><span class="o">+</span><span class="s2">&#34;&lt;/a&gt;&#34;</span><span class="p">;</span>
          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#popular&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;&lt;li&gt;&#34;</span> <span class="o">+</span> <span class="nx">anchor</span> <span class="o">+</span> <span class="s2">&#34;&lt;/li&gt;&#34;</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">});</span>
</code></pre></div><p>(end options.js)</p>
<p>As you can see, I’ve included jQuery for dom manipulation. I decided to do this because jQuery is so small and because the Options page can be whatever size you’d like (keeping in mind user experience, of course). This saved me some time from writing out a little bit of javascript.</p>
<p>Of note here is how I build the lists of Chrome pages, About pages, and Popular pages. This isn’t included in the options.html file, which only has placeholders for the unordered lists. This allows me to go in and provide a page name and url for chromePages and popularPages, or just the url for aboutPages. If I want to add anything in the future, I’ll just add a key/value pair (or url) to one of these objects. If I want to remove, likewise, I only touch the respective object.</p>
<p>Quick links (one from an above-mentioned object) are saved automatically, bypassing the url checking regex. However, you’ll notice in the save_options function that I check first to see if the url is in the list of about pages, this is because a user will most likely enter about:memory or any valid url, and whould be less likely to enter chrome-internal://newtab/. In the future, I will probably add checks on all objects before checking a valid url, but this kind of thing happens in incremental development.</p>
<p>As you can see, if the user gets to save the url, the function setUrl from the background page is called via chrome.extension.getBackgroundPage().setUrl(url); Following good user interface techniques, we have to let the user know what happened, which is what the next line and the rest of the function accomplishes.</p>
<p>Note: The new tab url is chrome-internal:// instead of chrome://. Why is this, do you think? Don’t think too hard, though. It’s simple: redirect.html is now chrome://newtab/, because I’ve told chrome to override the newtab with my own file. You can test it out by typing chrome://newtab into Google Chrome. Try chrome-internal://newtab and see what happens? This can only be called internally, hence the name, and must be called from within an extension via chrome.tabs.update. If you don’t use this internal url, when you set the url to chrome://newtab and hit CTRL+T or click the ‘+’ tab, your tab will keep trying to call itself, and eventually stop, after doing nothing meaningful.</p>
<h1 id="redirecthtml">Redirect.html</h1>
<p>Finally, the beast that does it all.</p>
<p>redirect.html</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;!DOCTYPE html PUBLIC &#34;-//W3C//DTD HTML 4.01 Transitional//EN&#34;&gt;</span>
  <span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
      <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&#34;generator&#34;</span> <span class="na">content=</span>
      <span class="s">&#34;HTML Tidy for Windows (vers 14 February 2006), see www.w3.org&#34;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;title&gt;</span>
        Redirecting...
      <span class="nt">&lt;/title&gt;</span>
      <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&#34;text/javascript&#34;</span><span class="nt">&gt;</span>
       var wid, tid;
    
       function r() {
           var url = localStorage[&#34;url&#34;] || &#34;&#34;;
           if (url.toLowerCase().indexOf(&#34;http:&#34;) === 0 || 
               url.toLowerCase().indexOf(&#34;https:&#34;) === 0) {
               document.location.href = url;
               return;
           } else {
               chrome.windows.getCurrent(function(w) {
                   wid = w.id;
                   chrome.tabs.getSelected(wid, function(t) {
                       tid = t.id;
                   });
               });
               chrome.extension.getBackgroundPage().r(tid);
           }
       }
   <span class="nt">&lt;/script&gt;</span>
     <span class="nt">&lt;/head&gt;</span>
     <span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">&#34;setTimeout(&#39;r()&#39;,100);r();return false;&#34;</span><span class="nt">&gt;</span>
       Redirecting...<span class="nt">&lt;br&gt;</span>
       <span class="nt">&lt;em&gt;</span>If your page doesn&#39;t load within 5 seconds, 
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&#34;javascript:r()&#34;</span><span class="nt">&gt;</span>click here<span class="nt">&lt;/a&gt;&lt;/em&gt;</span>
     <span class="nt">&lt;/body&gt;</span>
   <span class="nt">&lt;/html&gt;</span>
</code></pre></div><p>(end redirect.html)</p>
<p>Note: I have run the redirect.html file through HTML Tidy and a JavaScript formatter at <a href="http://jsbeautifier.org/">http://jsbeautifier.org/</a>, but this file should be as compact as possible. If you were to download New Tab Redirect and look at the source code, you’d see this code is all on one line. I’m writing this for your enjoyment, though, and one-liners aren’t fun to look at.</p>
<p>The only thing special about this file is the the onload function. You’ll notice how it runs r after 100 ms, then runs it again. There is quite an odd situation here: Chrome either has to initialize localStorage, doesn’t allow us to get the current window and tab id immediately, or the processing required to do so takes longer than 100ms. You could, honestly, run the redirect function through a loop until it redirects (considering the <em>document.location.href</em> will immediately redirect the browser tab. If the url specified by the user is local, the function gets the current window, and from that the id of the current tab, and passes that to the background page’s function.</p>
<p>I’ve been asked by a user or two to remove the redirect message, but I’ll keep it for now. I consider a message necessary if, for some reason, a future release of Chrome breaks the extension.</p>
<p>The current source code for New Tab Redirect can be accessed via your Chrome Extensions directory after installing the extension, and is availing at the  <a href="http://code.google.com/p/newtabredirect/">New Tab Redirect Project Page</a> on Google Code.</p>
<p>If you have any questions or comments about this extension, please contact me.</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/2010/02/quickly-create-a-dictionary-using-linq-to-objects/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Quickly create a Dictionary using Linq to Objects</span>
    </a>
    
    
    <a href="/2010/02/explaining-advanced-features-of-c-3-0/" class="navigation-next">
      <span class="navigation-tittle">Explaining advanced features of C# 3.0</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  


<div class="post__related">
    
    <h2>Related Articles</h2>
    <ul class="related-posts">
        
<li>
  <span class="list__title--small">
    <a href="/2009/12/google-chrome-extension-new-tab-redirect/" >Google Chrome Extension: New Tab Redirect!</a>
      
      <time class="pull-right hidden-tablet">Dec 20, 2009</time>
      
  </span>
</li>

<li>
  <span class="list__title--small">
    <a href="/2009/06/quake-tracker-using-google-maps-api-v3-and-xmlatom-feed/" >Quake Tracker using Google Maps API v3 and XML/Atom feed</a>
      
      <time class="pull-right hidden-tablet">Jun 17, 2009</time>
      
  </span>
</li>

<li>
  <span class="list__title--small">
    <a href="/2010/02/select-actions-chrome-extension/" >Select Actions, Chrome Extension</a>
      
      <time class="pull-right hidden-tablet">Feb 7, 2010</time>
      
  </span>
</li>

<li>
  <span class="list__title--small">
    <a href="/2010/01/new-tab-redirect/" >New Tab Redirect!</a>
      
      <time class="pull-right hidden-tablet">Jan 18, 2010</time>
      
  </span>
</li>

<li>
  <span class="list__title--small">
    <a href="/2009/12/jquery-checkuncheck-all-checkboxes-in-asp-net/" >jQuery check/uncheck all Checkboxes in ASP.NET</a>
      
      <time class="pull-right hidden-tablet">Dec 17, 2009</time>
      
  </span>
</li>


    </ul>
</div>



  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.11.2/js/all.js" integrity="sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1" crossorigin="anonymous"></script>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    





    



    </body>
</html>
